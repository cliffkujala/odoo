<?xml version="1.0" ?>
<openerp>
    <data>
        <!-- EDI related Email Templates menu -->
        <record model="ir.actions.act_window" id="action_email_templates">
            <field name="name">Email Templates</field>
            <field name="res_model">email.template</field>
            <field name="view_type">form</field>
            <field name="view_mode">form,tree</field>
            <field name="view_id" ref="email_template.email_template_tree" />
            <field name="search_view_id" ref="email_template.view_email_template_search"/>
            <field name="context" eval="{'search_default_model_id': ref('sale.model_sale_order')}"/>
        </record>

    <!-- Mail template is done in a NOUPDATE block
         so users can freely customize/delete them -->

        <!--Email template -->
        <template id="email_sale_order">
            <div style="font-family: 'Lucica Grande', Ubuntu, Arial, Verdana, sans-serif; font-size: 12px; color: rgb(34, 34, 34); background-color: #FFF; ">
                <p>Hello <t t-esc="object.partner_id.name"/></p>
                <p>Here is your
                    <t t-if="object.state in ['draft','sent']">
                        quotation
                    </t>
                    <t t-if="object.state not in ['draft','sent']">
                        order confirmation
                    </t>
                    from <t t-esc="object.partner_id.name"/>:
                </p>
                <p style="border-left: 1px solid #8e0000; margin-left: 30px;">
                    <strong>REFERENCES</strong><br />
                    Order number: <strong><t t-esc="object.name"/></strong><br/>
                    Order total: <strong>
                            <t t-esc="object.amount_total"/>
                            <t t-esc="object.pricelist_id.currency_id.name"/>
                            </strong><br/>
                    Order date: <t t-esc="object.date_order"/><br/>
                    <t t-if="object.validity_date and object.state in ['draft','sent']">
                        Expiration date: <t t-esc="object.validity_date"/><br/>
                    </t>
                    <t t-if="object.origin">
                        Order reference: <t t-esc="object.origin"/><br/>
                    </t>
                    <t t-if="object.client_order_ref">
                        Your reference: <t t-esc="object.client_order_ref"/><br/>
                    </t>
                    <t t-if="object.user_id">
                        Your contact: <a t-attf-href="mailto:#{object.user_id.email or ''}?subject=Order%20#{object.name}"><t t-esc="object.user_id.name"/></a>
                    </t>
                </p>
                <div name="view_quote"/>
                    <t t-if="object.paypal_url">
                        <p>It is also possible to directly pay with Paypal:</p>
                        <a style="margin-left: 120px;" t-attf-href="#{object.paypal_url}">
                            <img class="oe_edi_paypal_button" src="https://www.paypal.com/en_US/i/btn/btn_paynowCC_LG.gif"/>
                        </a>
                    </t>
                    <br/>
                    <p>If you have any question, do not hesitate to contact us.</p>
                    <p>Thank you for choosing 
                        <t t-if="object.company_id.name">
                            <t t-esc="object.company_id.name"/>
                        </t>
                        <t t-if="not object.company_id.name">
                            'us'
                        </t>!
                    </p><br/><br/>
                    <div style="width: 375px; margin: 0px; padding: 0px; background-color: #8E0000; border-top-left-radius: 5px 5px; border-top-right-radius: 5p">
                        <h3 style="margin: 0px; padding: 2px 14px; font-size: 12px; color: #DDD;">
                            <strong style="text-transform:uppercase;"><t t-esc="object.company_id.name"/></strong>
                        </h3>
                    </div>
                    <div style="width: 347px; margin: 0px; padding: 5px 14px; line-height: 16px; background-color: #F2F2F2;">
                        <span style="color: #222; margin-bottom: 5px; display: block; ">
                            <t t-if="object.company_id.street">
                                <t t-esc="object.company_id.street"></t><br/>
                            </t>
                            <t t-if="object.company_id.street2">
                                <t t-esc="object.company_id.street2"></t><br/>
                            </t>
                            <t t-if="object.company_id.city or object.company_id.zip">
                                <t t-esc="object.company_id.zip"/><t t-esc="object.company_id.city"/><br/>
                            </t>
                            <t t-if="object.company_id.country_id">
                                <t t-if="object.company_id.state_id">
                                    <t t-esc="object.company_id.state_id.name"/>
                                </t>
                                <t t-esc="object.company_id.country_id.name"/><br/>
                            </t>
                        </span>
                        <t t-if="object.company_id.phone">
                            <div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">
                                Phone:<t t-esc="object.company_id.phone"/>
                            </div>
                        </t>
                        <t t-if="object.company_id.website">
                            <div style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">
                                <div>
                                    Web :<a t-attf-href="#{object.company_id.website}"><t t-esc="object.company_id.website"/></a>
                                </div>
                            </div>
                        </t><p></p>
                  </div>
            </div>
        </template>
        <record id="email_template_edi_sale" model="email.template">
            <field name="name">Sales Order - Send by Email</field>
            <field name="email_from">${(object.user_id.email or '')|safe}</field>
            <field name="subject">${object.company_id.name|safe} ${object.state in ('draft', 'sent') and 'Quotation' or 'Order'} (Ref ${object.name or 'n/a' })</field>
            <field name="partner_to">${object.partner_invoice_id.id}</field>
            <field name="model_id" ref="sale.model_sale_order"/>
            <field name="auto_delete" eval="True"/>
            <field name="report_template" ref="report_sale_order"/>
            <field name="report_name">${(object.name or '').replace('/','_')}_${object.state == 'draft' and 'draft' or ''}</field>
            <field name="lang">${object.partner_id.lang}</field>
            <field name="body_html">
                ${object.render_email_template(template='sale.email_sale_order', values={'object': object}, context=ctx) | safe}
            </field>
        </record>
    </data>
</openerp>
